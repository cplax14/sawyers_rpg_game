<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sawyer's RPG Game</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas" width="800" height="600"></canvas>
        
        <!-- UI Overlay for game screens -->
        <div id="ui-overlay">
            <!-- Main Menu Screen -->
            <div id="main-menu" class="screen active">
                <div class="main-menu-content">
                    <div class="game-title-section">
                        <h1 class="game-title">Sawyer's RPG Game</h1>
                        <p class="game-subtitle">A Fantasy Adventure</p>
                    </div>

            
                    
                    <div class="main-menu-art">
                        <div class="menu-emblem">‚öîÔ∏è</div>
                    </div>
                    
                    <!-- Story Modal (MVP) moved out of main-menu -->
                    
                    <div class="menu-buttons">
                        <button id="new-game-btn" class="btn primary menu-btn">
                            <span class="btn-icon">üÜï</span>
                            <span class="btn-text">New Game</span>
                            <span class="btn-subtitle">Begin your adventure</span>
                        </button>
                        <button id="load-game-btn" class="btn secondary menu-btn">
                            <span class="btn-icon">üìÇ</span>
                            <span class="btn-text">Load Game</span>
                            <span class="btn-subtitle">Continue your journey</span>
                        </button>
                        <button id="settings-btn" class="btn secondary menu-btn">
                            <span class="btn-icon">‚öôÔ∏è</span>
                            <span class="btn-text">Settings</span>
                            <span class="btn-subtitle">Configure your game</span>
                        </button>
                    </div>
                    
                    <div class="menu-footer">
                        <p class="version-info">Version 1.0</p>
                        <p class="credit">Created for Sawyer</p>
                    </div>
                </div>
            </div>

            <!-- Character Selection Screen -->
            <div id="character-select" class="screen">
                <div class="character-select-content">
                    <header class="select-header">
                        <h2 class="select-title">Choose Your Class</h2>
                        <p class="select-subtitle">Select a class that matches your playstyle</p>
                    </header>
                    
                    <div class="selection-layout">
                        <div class="class-grid">
                            <div class="class-card" data-class="knight">
                                <div class="class-icon">üõ°Ô∏è</div>
                                <div class="class-info">
                                    <h3 class="class-name">Knight</h3>
                                    <p class="class-desc">Strong defense and sword mastery</p>
                                    <div class="class-highlights">
                                        <span class="highlight defense">High Defense</span>
                                        <span class="highlight tank">Tank Role</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="class-card" data-class="wizard">
                                <div class="class-icon">üîÆ</div>
                                <div class="class-info">
                                    <h3 class="class-name">Wizard</h3>
                                    <p class="class-desc">Master of elemental magic</p>
                                    <div class="class-highlights">
                                        <span class="highlight magic">High Magic</span>
                                        <span class="highlight elemental">Elemental</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="class-card" data-class="rogue">
                                <div class="class-icon">üó°Ô∏è</div>
                                <div class="class-info">
                                    <h3 class="class-name">Rogue</h3>
                                    <p class="class-desc">Swift and sneaky combatant</p>
                                    <div class="class-highlights">
                                        <span class="highlight speed">High Speed</span>
                                        <span class="highlight stealth">Stealth</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="class-card" data-class="paladin">
                                <div class="class-icon">‚ú®</div>
                                <div class="class-info">
                                    <h3 class="class-name">Paladin</h3>
                                    <p class="class-desc">Holy warrior with healing powers</p>
                                    <div class="class-highlights">
                                        <span class="highlight holy">Holy Magic</span>
                                        <span class="highlight healer">Healer</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="class-card" data-class="ranger">
                                <div class="class-icon">üèπ</div>
                                <div class="class-info">
                                    <h3 class="class-name">Ranger</h3>
                                    <p class="class-desc">Nature's guardian with bow mastery</p>
                                    <div class="class-highlights">
                                        <span class="highlight accuracy">High Accuracy</span>
                                        <span class="highlight nature">Nature Bond</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="class-card" data-class="warrior">
                                <div class="class-icon">‚öîÔ∏è</div>
                                <div class="class-info">
                                    <h3 class="class-name">Warrior</h3>
                                    <p class="class-desc">Fierce fighter with axe expertise</p>
                                    <div class="class-highlights">
                                        <span class="highlight attack">High Attack</span>
                                        <span class="highlight berserker">Berserker</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="class-details">
                            <div class="details-panel" id="class-details-panel">
                                <div class="no-selection">
                                    <div class="selection-prompt">
                                        <div class="prompt-icon">üëà</div>
                                        <p>Select a class to view details</p>
                                    </div>
                                </div>
                                
                                <div class="class-detail-content hidden" id="class-detail-content">
                                    <h3 class="detail-title" id="detail-class-name"></h3>
                                    <p class="detail-description" id="detail-class-desc"></p>
                                    
                                    <div class="stats-section">
                                        <h4>Starting Stats</h4>
                                        <div class="stats-grid" id="stats-grid">
                                            <!-- Stats will be populated dynamically -->
                                        </div>
                                    </div>
                                    
                                    <div class="spells-section">
                                        <h4>Starting Spells</h4>
                                        <div class="spells-list" id="starting-spells">
                                            <!-- Spells will be populated dynamically -->
                                        </div>
                                    </div>
                                    
                                    <div class="bonus-section">
                                        <h4>Class Bonus</h4>
                                        <p class="class-bonus" id="class-bonus-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-section">
                        <button id="start-adventure-btn" class="btn primary adventure-btn" disabled>
                            <span class="btn-icon">üö™</span>
                            <span class="btn-text">Start Adventure</span>
                        </button>
                        <button id="back-to-menu" class="btn secondary back-btn">
                            <span class="btn-icon">‚¨ÖÔ∏è</span>
                            <span class="btn-text">Back to Menu</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Game World Screen -->
            <div id="game-world" class="screen">
                <div class="world-content">
                    <header class="world-header">
                        <h2 class="world-title">World Map</h2>
                        <div class="player-location">
                            <span class="location-label">Current Location:</span>
                            <span class="current-area" id="current-area">Peaceful Village</span>
                        </div>
                    </header>
                    
                    <!-- World Map Visual -->
                    <div class="world-map-container">
                        <div class="world-map" id="world-map">
                            <!-- Map areas will be dynamically generated -->
                        </div>
                        
                        <!-- Map Legend -->
                        <div class="map-legend">
                            <h4>Legend</h4>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <span class="legend-icon town">üèòÔ∏è</span>
                                    <span class="legend-text">Town/Village</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-icon wilderness">üå≤</span>
                                    <span class="legend-text">Wilderness</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-icon dungeon">üè∞</span>
                                    <span class="legend-text">Dungeon</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-icon locked">üîí</span>
                                    <span class="legend-text">Locked Area</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-icon current">üìç</span>
                                    <span class="legend-text">Current Location</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Area Details Panel -->
                    <div class="area-details" id="area-details">
                        <div class="no-area-selected">
                            <div class="selection-prompt">
                                <div class="prompt-icon">üó∫Ô∏è</div>
                                <p>Click on an area to view details</p>
                            </div>
                        </div>
                        
                        <div class="area-info hidden" id="area-info">
                            <header class="area-header">
                                <div class="area-icon" id="area-icon">üèòÔ∏è</div>
                                <div class="area-title-section">
                                    <h3 class="area-name" id="area-name">Area Name</h3>
                                    <p class="area-type" id="area-type">Type</p>
                                </div>
                                <span id="story-pill" class="story-pill hidden" title="Story events available">Story Available</span>
                            </header>
                            
                            <div class="area-description" id="area-description">
                                Area description will appear here.
                            </div>
                            
                            <div class="area-stats">
                                <div class="stat-group">
                                    <h4>Exploration Info</h4>
                                    <div class="stats-grid">
                                        <div class="stat-item">
                                            <span class="stat-label">Encounter Rate:</span>
                                            <span class="stat-value" id="encounter-rate">0%</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Monsters:</span>
                                            <span class="stat-value" id="monster-count">0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="stat-group" id="monsters-section">
                                    <h4>Local Monsters</h4>
                                    <div class="monsters-list" id="monsters-list">
                                        <!-- Monster icons will be populated here -->
                                    </div>
                                </div>
                                
                                <div class="stat-group" id="services-section">
                                    <h4>Services Available</h4>
                                    <div class="services-list" id="services-list">
                                        <!-- Service icons will be populated here -->
                                    </div>
                                </div>
                                
                                <div class="stat-group" id="connections-section">
                                    <h4>Connected Areas</h4>
                                    <div class="connections-list" id="connections-list">
                                        <!-- Connected areas will be listed here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="area-actions"><!-- buttons moved to unified world-action-bar --></div>
                        </div>
                    </div>
                    
                    <!-- Quick Travel Menu -->
                    <div class="quick-travel">
                        <h4>Quick Travel</h4>
                        <div class="quick-travel-buttons" id="quick-travel-buttons">
                            <!-- Quick travel buttons will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Unified World Action Bar -->
                    <div class="world-action-bar" role="toolbar" aria-label="World actions">
                        <div class="action-bar-inner">
                            <button id="travel-to-area" class="btn primary" disabled>
                                <span class="btn-icon">üöÄ</span>
                                <span class="btn-text">Travel Here</span>
                            </button>
                            <button id="explore-area" class="btn secondary" disabled>
                                <span class="btn-icon">üîç</span>
                                <span class="btn-text">Explore</span>
                            </button>
                            <div class="spacer"></div>
                            <button id="back-from-world" class="btn secondary">
                                <span class="btn-icon">‚¨ÖÔ∏è</span>
                                <span class="btn-text">Back</span>
                            </button>
                            <button id="center-map" class="btn secondary">
                                <span class="btn-icon">üéØ</span>
                                <span class="btn-text">Center Map</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Combat Screen -->
            <div id="combat" class="screen">
                <!-- Battle Status Area -->
                <div class="combat-status">
                    <div class="battle-info">
                        <h3 id="battle-title">Battle</h3>
                        <div class="turn-info">
                            <span>Turn: <span id="current-turn">1</span></span>
                            <span id="current-actor">Player's Turn</span>
                        </div>
                    </div>
                </div>

                <!-- Combat Area -->
                <div class="combat-area">
                    <!-- Player Side -->
                    <div class="combat-side player-side">
                        <h4>Your Party</h4>
                        <div class="party-members">
                            <div class="combatant player" id="player-combatant">
                                <div class="combatant-name">Player</div>
                                <div class="health-bar">
                                    <div class="health-fill" style="width: 100%"></div>
                                    <span class="health-text">100/100</span>
                                </div>
                                <div class="mana-bar">
                                    <div class="mana-fill" style="width: 100%"></div>
                                    <span class="mana-text">50/50</span>
                                </div>
                                <div class="status-effects"></div>
                            </div>
                            <div class="monster-slots">
                                <!-- Active monsters will be inserted here -->
                            </div>
                        </div>
                    </div>

                    <!-- Enemy Side -->
                    <div class="combat-side enemy-side">
                        <h4>Enemies</h4>
                        <div class="enemy-combatants">
                            <!-- Enemy monsters will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Action Menu -->
                <div class="combat-actions">
                    <div class="action-menu" id="main-action-menu">
                        <h4>Choose Action:</h4>
                        <div class="action-buttons">
                            <button class="action-btn" id="attack-btn" data-action="attack">
                                <span class="action-icon">‚öîÔ∏è</span>
                                <span class="action-text">Attack</span>
                            </button>
                            <button class="action-btn" id="magic-btn" data-action="magic">
                                <span class="action-icon">‚ú®</span>
                                <span class="action-text">Magic</span>
                            </button>
                            <button class="action-btn" id="items-btn" data-action="items">
                                <span class="action-icon">üß™</span>
                                <span class="action-text">Items</span>
                            </button>
                            <button class="action-btn" id="capture-btn" data-action="capture">
                                <span class="action-icon">üéØ</span>
                                <span class="action-text">Capture</span>
                            </button>
                            <button class="action-btn" id="flee-btn" data-action="flee">
                                <span class="action-icon">üèÉ</span>
                                <span class="action-text">Flee</span>
                            </button>
                        </div>
                    </div>

                    <!-- Sub-menus (initially hidden) -->
                    <div class="action-submenu hidden" id="magic-submenu">
                        <h4>Select Spell:</h4>
                        <div class="spell-list">
                            <!-- Spells will be populated here -->
                        </div>
                        <button class="back-btn" id="magic-back-btn">‚Üê Back</button>
                    </div>

                    <div class="action-submenu hidden" id="items-submenu">
                        <h4>Select Item:</h4>
                        <div class="item-list">
                            <!-- Items will be populated here -->
                        </div>
                        <button class="back-btn" id="items-back-btn">‚Üê Back</button>
                    </div>

                    <div class="action-submenu hidden" id="target-selection">
                        <h4>Select Target:</h4>
                        <div class="target-list">
                            <!-- Targets will be populated here -->
                        </div>
                        <button class="back-btn" id="target-back-btn">‚Üê Back</button>
                    </div>
                </div>

                <!-- Battle Log -->
                <div class="battle-log">
                    <h4>Battle Log</h4>
                    <div class="log-messages" id="battle-log-messages">
                        <div class="log-message">Battle started!</div>
                    </div>
                </div>
            </div>

            <!-- Monster Management Screen -->
            <div id="monster-management" class="screen">
                <div class="monster-management-content">
                    <header class="monster-header">
                        <h2 class="monster-title">Monster Management</h2>
                        <p class="monster-subtitle">Manage your party, storage, and breeding</p>
                    </header>
                    
                    <!-- Tab Navigation -->
                    <div class="monster-tabs">
                        <button class="tab-btn active" data-tab="party">
                            <span class="tab-icon">üë•</span>
                            <span class="tab-text">Party</span>
                        </button>
                        <button class="tab-btn" data-tab="storage">
                            <span class="tab-icon">üì¶</span>
                            <span class="tab-text">Storage</span>
                        </button>
                        <button class="tab-btn" data-tab="breeding">
                            <span class="tab-icon">üíï</span>
                            <span class="tab-text">Breeding</span>
                        </button>
                    </div>
                    
                    <!-- Tab Content Panels -->
                    <div class="tab-content">
                        <!-- Party Tab -->
                        <div class="tab-panel active" id="party-panel">
                            <div class="party-section">
                                <h3>Active Party</h3>
                                <p class="party-info">Current party size: <span id="party-size">0</span>/3</p>
                                <div class="party-grid" id="party-grid">
                                    <!-- Party monsters will be populated here -->
                                </div>
                                
                                <div class="party-actions">
                                    <button id="heal-all-btn" class="btn secondary">
                                        <span class="btn-icon">‚ù§Ô∏è</span>
                                        <span class="btn-text">Heal All</span>
                                    </button>
                                    <button id="auto-arrange-btn" class="btn secondary">
                                        <span class="btn-icon">üîÑ</span>
                                        <span class="btn-text">Auto Arrange</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Storage Tab -->
                        <div class="tab-panel" id="storage-panel">
                            <div class="storage-section">
                                <div class="storage-header">
                                    <h3>Monster Storage</h3>
                                    <div class="storage-info">
                                        <span>Total monsters: <span id="total-monsters">0</span></span>
                                        <div class="storage-filters">
                                            <select id="type-filter" class="filter-select">
                                                <option value="">All Types</option>
                                                <option value="water">Water</option>
                                                <option value="fire">Fire</option>
                                                <option value="earth">Earth</option>
                                                <option value="air">Air</option>
                                                <option value="dark">Dark</option>
                                                <option value="light">Light</option>
                                            </select>
                                            <select id="rarity-filter" class="filter-select">
                                                <option value="">All Rarities</option>
                                                <option value="common">Common</option>
                                                <option value="uncommon">Uncommon</option>
                                                <option value="rare">Rare</option>
                                                <option value="epic">Epic</option>
                                                <option value="legendary">Legendary</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="storage-grid" id="storage-grid">
                                    <!-- Storage monsters will be populated here -->
                                </div>
                                
                                <div class="storage-actions">
                                    <button id="release-selected-btn" class="btn danger" disabled>
                                        <span class="btn-icon">üö™</span>
                                        <span class="btn-text">Release Selected</span>
                                    </button>
                                    <button id="sort-storage-btn" class="btn secondary">
                                        <span class="btn-icon">üìä</span>
                                        <span class="btn-text">Sort by Level</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Breeding Tab -->
                        <div class="tab-panel" id="breeding-panel">
                            <div class="breeding-section">
                                <h3>Monster Breeding</h3>
                                <p class="breeding-info">Breed compatible monsters to create new offspring</p>
                                
                                <div class="breeding-selection">
                                    <div class="breeding-slot" id="breeding-slot-1">
                                        <div class="slot-header">Parent 1</div>
                                        <div class="breeding-monster-slot empty" data-slot="1">
                                            <div class="empty-slot-content">
                                                <span class="empty-icon">‚ûï</span>
                                                <span class="empty-text">Select Monster</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="breeding-heart">üíñ</div>
                                    
                                    <div class="breeding-slot" id="breeding-slot-2">
                                        <div class="slot-header">Parent 2</div>
                                        <div class="breeding-monster-slot empty" data-slot="2">
                                            <div class="empty-slot-content">
                                                <span class="empty-icon">‚ûï</span>
                                                <span class="empty-text">Select Monster</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="breeding-info-panel" id="breeding-info-panel">
                                    <div class="compatibility-info">
                                        <h4>Compatibility Status</h4>
                                        <p id="compatibility-status">Select two monsters to check compatibility</p>
                                    </div>
                                    
                                    <div class="offspring-preview" id="offspring-preview">
                                        <h4>Possible Offspring</h4>
                                        <div id="offspring-list">Select compatible monsters to see possible outcomes</div>
                                    </div>
                                </div>
                                
                                <div class="breeding-actions">
                                    <button id="start-breeding-btn" class="btn primary" disabled>
                                        <span class="btn-icon">ü•ö</span>
                                        <span class="btn-text">Start Breeding</span>
                                    </button>
                                    <button id="clear-breeding-btn" class="btn secondary">
                                        <span class="btn-icon">üîÑ</span>
                                        <span class="btn-text">Clear Selection</span>
                                    </button>
                                </div>
                                
                                <div class="breeding-history">
                                    <h4>Recent Breeding History</h4>
                                    <div class="breeding-history-list" id="breeding-history-list">
                                        <p class="no-history">No breeding history yet</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Monster Detail Modal -->
                    <div class="monster-detail-modal hidden" id="monster-detail-modal">
                        <div class="modal-backdrop"></div>
                        <div class="modal-content">
                            <header class="modal-header">
                                <h3 id="modal-monster-name">Monster Details</h3>
                                <button class="modal-close" id="monster-modal-close">‚úï</button>
                            </header>
                            
                            <div class="modal-body">
                                <div class="monster-portrait">
                                    <div class="monster-icon" id="modal-monster-icon">üêâ</div>
                                    <div class="monster-level">Lv. <span id="modal-monster-level">1</span></div>
                                </div>
                                
                                <div class="monster-details-grid">
                                    <div class="detail-section">
                                        <h4>Stats</h4>
                                        <div class="stats-display" id="modal-stats">
                                            <!-- Stats will be populated here -->
                                        </div>
                                    </div>
                                    
                                    <div class="detail-section">
                                        <h4>Abilities</h4>
                                        <div class="abilities-display" id="modal-abilities">
                                            <!-- Abilities will be populated here -->
                                        </div>
                                    </div>
                                    
                                    <div class="detail-section">
                                        <h4>Info</h4>
                                        <div class="info-display" id="modal-info">
                                            <!-- Monster info will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="modal-actions">
                                <button id="modal-add-to-party" class="btn primary">Add to Party</button>
                                <button id="modal-remove-from-party" class="btn secondary hidden">Remove from Party</button>
                                <button id="modal-release-monster" class="btn danger">Release</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navigation -->
                    <div class="monster-nav">
                        <button id="back-from-monsters" class="btn secondary">
                            <span class="btn-icon">‚¨ÖÔ∏è</span>
                            <span class="btn-text">Back</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Inventory Screen -->
            <div id="inventory" class="screen">
                <div class="inventory-content">
                    <header class="inventory-header">
                        <h2 class="inventory-title">Inventory &amp; Equipment</h2>
                        <div class="player-gold">
                            <span class="gold-icon">üí∞</span>
                            <span class="gold-amount" id="inventory-gold">0</span>
                            <span class="gold-label">Gold</span>
                        </div>
                    </header>
                    
                    <!-- Tab Navigation -->
                    <div class="inventory-tabs" id="inventory-tabs">
                        <button class="tab-btn active" data-tab="equipment">
                            <span class="tab-icon">‚öîÔ∏è</span>
                            <span class="tab-text">Equipment</span>
                        </button>
                        <button class="tab-btn" data-tab="items">
                            <span class="tab-icon">üß™</span>
                            <span class="tab-text">Items</span>
                        </button>
                        <button class="tab-btn" data-tab="materials">
                            <span class="tab-icon">üîß</span>
                            <span class="tab-text">Materials</span>
                        </button>
                    </div>
                    
                    <!-- Equipment Tab -->
                    <div class="inventory-tab-content active" id="equipment-tab">
                        <div class="equipment-layout">
                            <!-- Character Display -->
                            <div class="character-display">
                                <div class="character-info">
                                    <h3 id="character-name">Player</h3>
                                    <p class="character-class" id="character-class">Knight</p>
                                    <p class="character-level">Level <span id="character-level">1</span></p>
                                    <div class="experience-progress">
                                        <div class="exp-info">
                                            <span class="exp-text">EXP: <span id="character-experience">0</span> / <span id="character-experience-next">100</span></span>
                                            <span class="exp-percent" id="character-experience-percent"> (0%)</span>
                                        </div>
                                        <div class="exp-bar">
                                            <div class="exp-fill" id="character-exp-fill" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Equipment Slots -->
                                <div class="equipment-slots">
                                    <div class="equipment-slot weapon-slot" data-slot="weapon">
                                        <div class="slot-icon">‚öîÔ∏è</div>
                                        <div class="slot-label">Weapon</div>
                                        <div class="equipped-item" id="equipped-weapon">
                                            <div class="item-icon">‚ùå</div>
                                            <div class="item-name">None</div>
                                        </div>
                                    </div>
                                    
                                    <div class="equipment-slot armor-slot" data-slot="armor">
                                        <div class="slot-icon">üõ°Ô∏è</div>
                                        <div class="slot-label">Armor</div>
                                        <div class="equipped-item" id="equipped-armor">
                                            <div class="item-icon">‚ùå</div>
                                            <div class="item-name">None</div>
                                        </div>
                                    </div>
                                    
                                    <div class="equipment-slot accessory-slot" data-slot="accessory">
                                        <div class="slot-icon">üíç</div>
                                        <div class="slot-label">Accessory</div>
                                        <div class="equipped-item" id="equipped-accessory">
                                            <div class="item-icon">‚ùå</div>
                                            <div class="item-name">None</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Stats Display -->
                                <div class="character-stats">
                                    <h4>Current Stats</h4>
                                    <div class="stats-grid">
                                        <div class="stat-item">
                                            <span class="stat-label">HP:</span>
                                            <span class="stat-value" id="stat-hp">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">MP:</span>
                                            <span class="stat-value" id="stat-mp">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Attack:</span>
                                            <span class="stat-value" id="stat-attack">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Defense:</span>
                                            <span class="stat-value" id="stat-defense">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Magic Att:</span>
                                            <span class="stat-value" id="stat-magic-attack">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Magic Def:</span>
                                            <span class="stat-value" id="stat-magic-defense">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Speed:</span>
                                            <span class="stat-value" id="stat-speed">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Accuracy:</span>
                                            <span class="stat-value" id="stat-accuracy">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Equipment Inventory -->
                            <div class="equipment-inventory">
                                <h4>Available Equipment</h4>
                                <div class="equipment-filters">
                                    <button class="filter-btn active" data-filter="all">All</button>
                                    <button class="filter-btn" data-filter="weapon">Weapons</button>
                                    <button class="filter-btn" data-filter="armor">Armor</button>
                                    <button class="filter-btn" data-filter="accessory">Accessories</button>
                                </div>
                                <div class="equipment-list" id="equipment-list">
                                    <!-- Equipment items will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Items Tab -->
                    <div class="inventory-tab-content" id="items-tab">
                        <div class="items-layout">
                            <div class="items-header">
                                <h3>Consumable Items</h3>
                                <div class="items-filters">
                                    <button class="filter-btn active" data-filter="all">All</button>
                                    <button class="filter-btn" data-filter="healing">Healing</button>
                                    <button class="filter-btn" data-filter="restoration">Restoration</button>
                                    <button class="filter-btn" data-filter="cure">Cure</button>
                                    <button class="filter-btn" data-filter="capture">Capture</button>
                                </div>
                            </div>
                            
                            <div class="items-grid" id="items-grid">
                                <!-- Item cards will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Materials Tab -->
                    <div class="inventory-tab-content" id="materials-tab">
                        <div class="materials-layout">
                            <div class="materials-header">
                                <h3>Crafting Materials & Scrolls</h3>
                                <div class="materials-filters">
                                    <button class="filter-btn active" data-filter="all">All</button>
                                    <button class="filter-btn" data-filter="material">Materials</button>
                                    <button class="filter-btn" data-filter="scroll">Scrolls</button>
                                </div>
                            </div>
                            
                            <div class="materials-grid" id="materials-grid">
                                <!-- Material cards will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Item Detail Modal -->
                    <div class="item-detail-modal hidden" id="item-detail-modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="item-detail-name">Item Name</h3>
                                <button class="close-btn" id="close-item-detail">√ó</button>
                            </div>
                            <div class="modal-body">
                                <div class="item-detail-info">
                                    <div class="item-detail-icon" id="item-detail-icon">üéØ</div>
                                    <div class="item-detail-stats">
                                        <p class="item-description" id="item-detail-description">Item description</p>
                                        <div class="item-rarity" id="item-detail-rarity">Common</div>
                                        <div class="item-stats" id="item-detail-stats">
                                            <!-- Stats will be populated here -->
                                        </div>
                                        <div class="item-value">Value: <span id="item-detail-value">0</span> Gold</div>
                                    </div>
                                </div>
                                <div class="item-actions">
                                    <button class="btn primary" id="equip-item-btn" style="display: none;">Equip</button>
                                    <button class="btn primary" id="use-item-btn" style="display: none;">Use</button>
                                    <button class="btn secondary" id="sell-item-btn">Sell</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navigation -->
                    <div class="inventory-nav">
                        <button id="back-from-inventory" class="btn secondary">
                            <span class="btn-icon">‚¨ÖÔ∏è</span>
                            <span class="btn-text">Back</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Screen -->
            <div id="settings" class="screen">
                <div class="settings-content">
                    <header class="settings-header">
                        <h2 class="settings-title">Game Settings</h2>
                        <p class="settings-subtitle">Configure your gaming experience</p>
                    </header>
                    
                    <!-- Settings Categories -->
                    <div class="settings-categories">
                        <button class="category-btn active" data-category="audio">
                            <span class="category-icon">üîä</span>
                            <span class="category-text">Audio</span>
                        </button>
                        <button class="category-btn" data-category="gameplay">
                            <span class="category-icon">üéÆ</span>
                            <span class="category-text">Gameplay</span>
                        </button>
                        <button class="category-btn" data-category="display">
                            <span class="category-icon">üñ•Ô∏è</span>
                            <span class="category-text">Display</span>
                        </button>
                        <button class="category-btn" data-category="controls">
                            <span class="category-icon">‚å®Ô∏è</span>
                            <span class="category-text">Controls</span>
                        </button>
                        <button class="category-btn" data-category="data">
                            <span class="category-icon">üíæ</span>
                            <span class="category-text">Data</span>
                        </button>
                    </div>
                    
                    <!-- Audio Settings -->
                    <div class="settings-panel active" id="audio-settings">
                        <h3 class="panel-title">Audio Settings</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Master Volume</label>
                                    <p class="setting-description">Overall game volume</p>
                                </div>
                                <div class="setting-control">
                                    <input type="range" id="master-volume" min="0" max="100" value="50" class="volume-slider">
                                    <span class="setting-value" id="master-volume-value">50%</span>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Music Volume</label>
                                    <p class="setting-description">Background music volume</p>
                                </div>
                                <div class="setting-control">
                                    <input type="range" id="music-volume" min="0" max="100" value="70" class="volume-slider">
                                    <span class="setting-value" id="music-volume-value">70%</span>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Sound Effects</label>
                                    <p class="setting-description">Sound effects and UI sounds</p>
                                </div>
                                <div class="setting-control">
                                    <input type="range" id="sfx-volume" min="0" max="100" value="75" class="volume-slider">
                                    <span class="setting-value" id="sfx-volume-value">75%</span>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Voice Volume</label>
                                    <p class="setting-description">Character voices and dialogue</p>
                                </div>
                                <div class="setting-control">
                                    <input type="range" id="voice-volume" min="0" max="100" value="80" class="volume-slider">
                                    <span class="setting-value" id="voice-volume-value">80%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gameplay Settings -->
                    <div class="settings-panel" id="gameplay-settings">
                        <h3 class="panel-title">Gameplay Settings</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Difficulty Level</label>
                                    <p class="setting-description">Game difficulty affects combat and progression</p>
                                </div>
                                <div class="setting-control">
                                    <select id="difficulty-level" class="setting-select">
                                        <option value="easy">Easy</option>
                                        <option value="normal" selected>Normal</option>
                                        <option value="hard">Hard</option>
                                        <option value="nightmare">Nightmare</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Auto-Save</label>
                                    <p class="setting-description">Automatically save game progress</p>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-save" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Auto-Save Interval</label>
                                    <p class="setting-description">How often to auto-save (minutes)</p>
                                </div>
                                <div class="setting-control">
                                    <select id="autosave-interval" class="setting-select">
                                        <option value="1">1 minute</option>
                                        <option value="5" selected>5 minutes</option>
                                        <option value="10">10 minutes</option>
                                        <option value="15">15 minutes</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Battle Animations</label>
                                    <p class="setting-description">Show detailed battle animations</p>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="battle-animations" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Skip Intro</label>
                                    <p class="setting-description">Skip opening sequences</p>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="skip-intro">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Monster Notifications</label>
                                    <p class="setting-description">Show notifications for monster events</p>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="monster-notifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Display Settings -->
                    <div class="settings-panel" id="display-settings">
                        <h3 class="panel-title">Display Settings</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Theme</label>
                                    <p class="setting-description">Visual theme for the game interface</p>
                                </div>
                                <div class="setting-control">
                                    <select id="theme" class="setting-select">
                                        <option value="fantasy" selected>Fantasy</option>
                                        <option value="dark">Dark</option>
                                        <option value="light">Light</option>
                                        <option value="colorful">Colorful</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">UI Scale</label>
                                    <p class="setting-description">Scale of user interface elements</p>
                                </div>
                                <div class="setting-control">
                                    <input type="range" id="ui-scale" min="80" max="120" value="100" class="scale-slider">
                                    <span class="setting-value" id="ui-scale-value">100%</span>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Show FPS</label>
                                    <p class="setting-description">Display frames per second counter</p>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="show-fps">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Reduce Motion</label>
                                    <p class="setting-description">Minimize animations and transitions</p>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="reduce-motion">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">High Contrast</label>
                                    <p class="setting-description">Use high contrast colors for accessibility</p>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="high-contrast">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Controls Settings -->
                    <div class="settings-panel" id="controls-settings">
                        <h3 class="panel-title">Controls Settings</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Keyboard Shortcuts</label>
                                    <p class="setting-description">Enable keyboard shortcuts for actions</p>
                                </div>
                                <div class="setting-control">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="keyboard-shortcuts" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Mouse Sensitivity</label>
                                    <p class="setting-description">Adjust mouse movement sensitivity</p>
                                </div>
                                <div class="setting-control">
                                    <input type="range" id="mouse-sensitivity" min="1" max="10" value="5" class="sensitivity-slider">
                                    <span class="setting-value" id="mouse-sensitivity-value">5</span>
                                </div>
                            </div>
                            
                            <div class="setting-item wide-item">
                                <div class="setting-info">
                                    <label class="setting-label">Key Bindings</label>
                                    <p class="setting-description">Customize keyboard shortcuts</p>
                                </div>
                                <div class="key-bindings">
                                    <div class="key-binding">
                                        <span class="action-label">Menu</span>
                                        <button class="key-btn" data-action="menu" id="key-menu">Escape</button>
                                    </div>
                                    <div class="key-binding">
                                        <span class="action-label">Inventory</span>
                                        <button class="key-btn" data-action="inventory" id="key-inventory">I</button>
                                    </div>
                                    <div class="key-binding">
                                        <span class="action-label">World Map</span>
                                        <button class="key-btn" data-action="map" id="key-map">M</button>
                                    </div>
                                    <div class="key-binding">
                                        <span class="action-label">Monsters</span>
                                        <button class="key-btn" data-action="monsters" id="key-monsters">P</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Settings -->
                    <div class="settings-panel" id="data-settings">
                        <h3 class="panel-title">Data Management</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Clear Save Data</label>
                                    <p class="setting-description">Delete all saved game progress</p>
                                </div>
                                <div class="setting-control">
                                    <button id="clear-save-data" class="btn danger">Clear Data</button>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Export Save</label>
                                    <p class="setting-description">Download your save file as backup</p>
                                </div>
                                <div class="setting-control">
                                    <button id="export-save" class="btn secondary">Export</button>
                                </div>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Export Save Schema</label>
                                    <p class="setting-description">Download JSON schema for debugging migrations</p>
                                </div>
                                <div class="setting-control">
                                    <button id="export-save-schema" class="btn secondary">Export Schema</button>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Import Save</label>
                                    <p class="setting-description">Load save file from backup</p>
                                </div>
                                <div class="setting-control">
                                    <input type="file" id="import-save" accept=".json,.sav" style="display: none;">
                                    <button id="import-save-btn" class="btn secondary">Import</button>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Reset Settings</label>
                                    <p class="setting-description">Reset all settings to defaults</p>
                                </div>
                                <div class="setting-control">
                                    <button id="reset-settings" class="btn warning">Reset</button>
                                </div>
                            </div>
                            
                            <div class="setting-item wide-item">
                                <div class="setting-info">
                                    <label class="setting-label">Game Statistics</label>
                                    <p class="setting-description">Your gaming progress and achievements</p>
                                </div>
                                <div class="game-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Playtime:</span>
                                        <span class="stat-value" id="stat-playtime">0h 0m</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Monsters Captured:</span>
                                        <span class="stat-value" id="stat-monsters-captured">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Battles Won:</span>
                                        <span class="stat-value" id="stat-battles-won">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Areas Explored:</span>
                                        <span class="stat-value" id="stat-areas-explored">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navigation -->
                    <div class="settings-nav">
                        <button id="back-to-menu-btn" class="btn secondary">
                            <span class="btn-icon">‚¨ÖÔ∏è</span>
                            <span class="btn-text">Back</span>
                        </button>
                        <button id="apply-settings-btn" class="btn primary">
                            <span class="btn-icon">‚úÖ</span>
                            <span class="btn-text">Apply Changes</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Story Modal (MVP) placed as a top-level child of #ui-overlay -->
        <div id="story-modal" class="hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <header class="modal-header">
                    <h3 id="story-title">Story</h3>
                    <button class="modal-close" id="story-close">‚úï</button>
                </header>
                <div class="modal-body">
                    <div class="story-line">
                        <div class="story-speaker" id="story-speaker"></div>
                        <div class="story-text" id="story-text"></div>
                    </div>
                    <div class="story-choices hidden" id="story-choices"></div>
                </div>
                <footer class="modal-footer">
                    <button id="story-next" class="btn primary"><span class="btn-text">Next</span></button>
                </footer>
            </div>
        </div>

        <!-- Game HUD (always visible during gameplay) -->
        <div id="game-hud" class="hidden">
            <div class="hud-section player-stats">
                <div class="stat">Level: <span id="player-level">1</span></div>
                <div class="stat">HP: <span id="player-hp">100</span>/<span id="player-max-hp">100</span></div>
                <div class="stat">MP: <span id="player-mp">50</span>/<span id="player-max-mp">50</span></div>
                <div class="stat">Gold: <span id="player-gold">0</span></div>
            </div>
            
            <div class="hud-section action-buttons">
                <button id="world-map-btn" class="btn hud">Map</button>
                <button id="monsters-btn" class="btn hud">Monsters</button>
                <button id="inventory-btn" class="btn hud">Inventory</button>
                <button id="save-game-btn" class="btn hud">Save</button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript modules -->
    <script src="js/spellSystem.js"></script>
    <script src="js/gameState.js"></script>
    
    <!-- New Modular UI System (replaces legacy js/ui.js) -->
    <script src="js/ui/BaseUIModule.js"></script>
    <script src="js/ui/UIHelpers.js"></script>
    <script src="js/ui/SceneManager.js"></script>
    <script src="js/ui/NotificationBridge.js"></script>
    <script src="js/ui/UIModuleLoader.js"></script>
    <script src="js/ui/TransitionController.js"></script>
    <script src="js/ui/UIManager.js"></script>
    <!-- UI Modules -->
    <script src="js/ui/MenuUI.js"></script>
    <script src="js/ui/GameWorldUI.js"></script>
    <script src="js/ui/CombatUI.js"></script>
    <script src="js/ui/MonsterUI.js"></script>
    <script src="js/ui/InventoryUI.js"></script>
    <script src="js/ui/SettingsUI.js"></script>
    <script src="js/ui/StoryUI.js"></script>
    <script src="js/player.js"></script>
    <script src="js/monster.js"></script>
    <script src="js/monsterBreeding.js"></script>
    <script src="js/combat.js"></script>
    <script src="js/worldMap.js"></script>
    <script src="js/lootSystem.js"></script>
    <script src="js/saveSystem.js"></script>
    
    <!-- Load game data -->
    <script src="data/characters.js"></script>
    <script src="data/monsters.js"></script>
    <script src="data/areas.js"></script>
    <script src="data/items.js"></script>
    <script src="data/spells.js"></script>
    <script src="data/story.js"></script>
    
    <!-- Load main game after data -->
    <script src="js/game.js"></script>
</body>
</html>