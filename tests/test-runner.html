<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sawyer's RPG Game - Test Runner</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background-color: #1a1a1a;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #2d1b0e, #5d4037);
            color: #d4af37;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2rem;
        }
        
        .controls {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            background: linear-gradient(145deg, #d4af37, #b8860b);
            color: #2d1b0e;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: linear-gradient(145deg, #b8860b, #8b7355);
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-group input[type="checkbox"] {
            accent-color: #d4af37;
        }
        
        .checkbox-group label {
            color: #e0e0e0;
            cursor: pointer;
        }
        
        .output {
            background: #1e1e1e;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 70vh;
        }
        
        .status {
            background: #2a2a2a;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .status.running {
            background: #1a4d3a;
            border-left: 4px solid #28a745;
            display: block;
        }
        
        .status.completed {
            background: #3a3a1a;
            border-left: 4px solid #ffc107;
            display: block;
        }
        
        .status.error {
            background: #4d1a1a;
            border-left: 4px solid #dc3545;
            display: block;
        }
        
        .test-info {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .test-info h3 {
            color: #d4af37;
            margin-top: 0;
        }
        
        .test-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .test-file {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #d4af37;
        }
        
        .test-file h4 {
            margin-top: 0;
            color: #d4af37;
        }
        
        .test-file p {
            margin: 5px 0;
            color: #b0b0b0;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéÆ Sawyer's RPG Game Test Suite</h1>
        <p>Unit Testing Framework for Game Components</p>
    </div>
    
    <div class="test-info">
        <h3>üìã Available Test Suites</h3>
        <div class="test-list">
            <div class="test-file">
                <h4>üéØ Core Game Tests</h4>
                <p>‚Ä¢ Game initialization and setup</p>
                <p>‚Ä¢ Game loop functionality</p>
                <p>‚Ä¢ Event handling systems</p>
                <p>‚Ä¢ Utility methods</p>
            </div>
            <div class="test-file">
                <h4>üìä Data Module Tests</h4>
                <p>‚Ä¢ Character class definitions</p>
                <p>‚Ä¢ Monster species and breeding</p>
                <p>‚Ä¢ World areas and progression</p>
                <p>‚Ä¢ Story events and endings</p>
            </div>
        </div>
    </div>
    
    <div class="controls">
        <button id="run-all-tests" class="btn">üöÄ Run All Tests</button>
        <button id="run-game-tests" class="btn">üéØ Run Game Tests</button>
        <button id="run-data-tests" class="btn">üìä Run Data Tests</button>
        <button id="run-ui-tests" class="btn">üé® Run UI Tests</button>
        <button id="validate-ui-refactoring" class="btn">üîç Validate UI Refactoring</button>
        <button id="clear-output" class="btn">üßπ Clear Output</button>
        
        <div class="checkbox-group">
            <input type="checkbox" id="verbose-mode" />
            <label for="verbose-mode">Verbose Output</label>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="auto-scroll" checked />
            <label for="auto-scroll">Auto Scroll</label>
        </div>
    </div>
    
    <div id="status" class="status">
        <span id="status-text">Ready to run tests</span>
    </div>
    
    <div id="output" class="output">
üìå Test Runner Ready

Click "Run All Tests" to execute the complete test suite, or run individual test categories.

Available Commands:
‚Ä¢ runTests() - Run all loaded tests
‚Ä¢ setVerbose(true) - Enable detailed output
‚Ä¢ TestFramework - Access the test framework directly

Loaded Modules:
‚Ä¢ Test Framework: ‚úÖ
‚Ä¢ Game Data: Checking...
‚Ä¢ Game Engine: Checking...
</div>

    <!-- Load Test Framework -->
    <script src="test-framework.js"></script>
    
    <!-- Load Game Data for Testing -->
    <script src="../data/characters.js"></script>
    <script src="../data/monsters.js"></script>
    <script src="../data/areas.js"></script>
    <script src="../data/items.js"></script>
    <script src="../data/spells.js"></script>
    <script src="../data/story.js"></script>
    
    <!-- Load Game Engine for Testing (with mocking) -->
    <script>
        // Mock DOM elements for testing
        const mockCanvas = document.createElement('canvas');
        mockCanvas.id = 'game-canvas';
        mockCanvas.width = 800;
        mockCanvas.height = 600;
        document.body.appendChild(mockCanvas);
        
        // Override some browser APIs for testing
        window.requestAnimationFrame = window.requestAnimationFrame || ((callback) => {
            return setTimeout(callback, 16);
        });
        window.cancelAnimationFrame = window.cancelAnimationFrame || clearTimeout;
    </script>
    <script src="../js/spellSystem.js"></script>
    <script src="../js/gameState.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/monster.js"></script>
    <script src="../js/monsterBreeding.js"></script>
    <script src="../js/combat.js"></script>
    <!-- Removed legacy ui.js to avoid global symbol redeclarations with modular UI -->
    
    <!-- Enable UI debug logging via query param ?debug=1 -->
    <script>
        (function(){
            try {
                const params = new URLSearchParams(window.location.search);
                const dbg = params.get('debug');
                if (dbg === '1' || dbg === 'true') {
                    window.UI_DEBUG = true;
                    console.log('üîß UI_DEBUG enabled via query parameter');
                }
            } catch (e) {
                // ignore in tests
            }
        })();
    </script>

    <!-- UI Module System (dependencies first) -->
    <script src="../js/ui/BaseUIModule.js"></script>
    <script src="../js/ui/UIHelpers.js"></script>
    <script src="../js/ui/SceneManager.js"></script>
    <script src="../js/ui/NotificationBridge.js"></script>
    <script src="../js/ui/UIModuleLoader.js"></script>
    <script src="../js/ui/TransitionController.js"></script>
    <script src="../js/ui/UIManager.js"></script>
    <script src="../js/ui/MenuUI.js"></script>
    <script src="../js/ui/GameWorldUI.js"></script>
    <script src="../js/ui/CombatUI.js"></script>
    <script src="../js/ui/MonsterUI.js"></script>
    <script src="../js/ui/InventoryUI.js"></script>
    <script src="../js/ui/SettingsUI.js"></script>
    <script src="../js/ui/StoryUI.js"></script>

    <script src="../js/saveSystem.js"></script>
    <script src="../js/game.js"></script>
    
    <!-- Minimal DOM skeletons for UI validators -->
    <style>
        .world-content { display: flex; }
        .world-map-container { display: grid; grid-template-columns: 1fr; }
        #world-map { background: linear-gradient(90deg, #223, #445); }
        /* Responsive checks */
        @media (max-width: 768px) { .world-content { flex-direction: column; } }
        @media (max-width: 480px) { .world-map-container { grid-template-columns: 1fr; } }
    </style>
    <div id="game-world" class="scene">
        <header class="world-title"><h2>World Map</h2></header>
        <div class="world-nav">
            <button id="world-map-btn">Open Map</button>
        </div>
        <div class="world-content">
            <div class="world-map-container">
                <div id="world-map"></div>
            </div>
            <div class="area-info">
                <div id="current-area">Starting Village</div>
                <section class="area-stats">
                    <div id="encounter-rate">0%</div>
                    <div id="monster-count">0</div>
                    <div id="monsters-list"></div>
                    <div id="services-list"></div>
                    <div id="connections-list"></div>
                </section>
                <div class="area-actions">
                    <button id="travel-to-area">Travel</button>
                    <button id="explore-area">Explore</button>
                </div>
                <div class="quick-travel" id="quick-travel-buttons"></div>
                <div class="world-controls">
                    <button id="back-from-world">Back</button>
                    <button id="center-map">Center</button>
                </div>
            </div>
        </div>
    </div>

    <div id="inventory" class="scene">
        <div id="inventory-content" class="inventory-content" style="display:flex">
            <header id="inventory-header"><span id="inventory-gold">0</span></header>
            <nav id="inventory-tabs" class="inventory-tabs">
                <button class="tab-btn" data-tab="equipment">Equipment</button>
                <button class="tab-btn" data-tab="items">Items</button>
                <button class="tab-btn" data-tab="materials">Materials</button>
            </nav>
            <section id="equipment-tab" class="inventory-tab-content">
                <div id="character-display">
                    <div id="character-name">Hero</div>
                    <div id="character-class">Knight</div>
                    <div id="character-level">1</div>
                    <div id="character-stats">
                        <span id="stat-hp">0</span>
                        <span id="stat-mp">0</span>
                        <span id="stat-attack">0</span>
                        <span id="stat-defense">0</span>
                        <span id="stat-magic-attack">0</span>
                        <span id="stat-magic-defense">0</span>
                        <span id="stat-speed">0</span>
                        <span id="stat-accuracy">0</span>
                    </div>
                </div>
                <div id="equipment-panel">
                    <div class="equipment-row"><span class="equipment-slot" data-slot="weapon">Weapon</span><span class="equipment-item">None</span></div>
                    <div class="equipment-row"><span class="equipment-slot" data-slot="armor">Armor</span><span class="equipment-item">None</span></div>
                    <div class="equipment-row"><span class="equipment-slot" data-slot="accessory">Accessory</span><span class="equipment-item">None</span></div>
                </div>
                <div class="equipment-filters">
                    <button class="filter-btn" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="weapon">Weapons</button>
                    <button class="filter-btn" data-filter="armor">Armor</button>
                    <button class="filter-btn" data-filter="accessory">Accessories</button>
                </div>
                <div id="equipment-list"></div>
            </section>
            <section id="items-tab" class="inventory-tab-content">
                <div class="items-filters">
                    <button class="filter-btn" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="consumable">Consumables</button>
                </div>
                <div id="items-grid"></div>
            </section>
            <section id="materials-tab" class="inventory-tab-content">
                <div class="materials-filters">
                    <button class="filter-btn" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="ore">Ore</button>
                </div>
                <div id="materials-grid"></div>
            </section>
            <button id="back-from-inventory"></button>
        </div>
        <div id="item-detail-modal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <h3 id="item-detail-name"></h3>
                <div id="item-detail-desc"></div>
                <div id="item-detail-stats"></div>
                <button id="equip-item-btn"></button>
                <button id="use-item-btn"></button>
                <button id="sell-item-btn"></button>
                <button id="close-item-detail"></button>
            </div>
        </div>
    </div>

    <!-- Load Test Files -->
    <script src="game.test.js"></script>
    <script src="data.test.js"></script>
    <script src="monster.test.js"></script>
    <script src="breeding.test.js"></script>
    <script src="skills.test.js"></script>
    <script src="combat.test.js"></script>
    <script src="combat_actions.test.js"></script>
    <script src="spell_casting_integration.test.js"></script>
    <script src="combat_status.test.js"></script>
    <script src="combat_ai.test.js"></script>
    <script src="combat_rewards.test.js"></script>
    <script src="capture_chance.test.js"></script>
    <script src="world_map.test.js"></script>
    <script src="random_encounters.test.js"></script>
    <script src="spawn_tables.test.js"></script>
    <script src="save_system.test.js"></script>
    <script src="browser_compatibility.test.js"></script>
    <script src="core_systems_integration.test.js"></script>
    <script src="playtest_automation.test.js"></script>
    <script src="ui_world_map.test.js"></script>
    <script src="validate_world_map.js"></script>
    <script src="validate_inventory.js"></script>
    <script src="ui_story_basic.test.js"></script>
    <script src="ui_endings.test.js"></script>
    <script src="ui_story_content.test.js"></script>
    <script src="ui_story_branches.test.js"></script>
    <script src="story_progression.test.js"></script>
    <script src="story_accessibility.test.js"></script>
    <script src="story_path_validation.test.js"></script>
    <script src="story_smoke_test.test.js"></script>
    <script src="ui_menu_smoke.test.js"></script>
    <script src="ui_world_map_interactions.test.js"></script>
    <script src="ui_explore_encounter.test.js"></script>
    
    <!-- UI Module Tests -->
    <script src="ui_modules.test.js"></script>
    <script src="ui_loader_fallback.test.js"></script>
    <script src="ui_world_map_edge_cases.test.js"></script>
    <script src="ui_settings_edge_cases.test.js"></script>
    <script src="ui_inventory_edge_cases.test.js"></script>
    <script src="ui_monster_storage_verification.test.js"></script>
    <script src="validate_ui_refactoring.js"></script>
    
    <script>
        // Test runner interface
        const output = document.getElementById('output');
        const status = document.getElementById('status');
        const statusText = document.getElementById('status-text');
        const verboseCheckbox = document.getElementById('verbose-mode');
        const autoScrollCheckbox = document.getElementById('auto-scroll');
        
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;
        let originalConsoleWarn = console.warn;
        
        function setupConsoleCapture() {
            console.log = (...args) => {
                const message = args.map(arg => 
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                ).join(' ');
                
                appendOutput(message);
                originalConsoleLog.apply(console, args);
            };
            
            console.error = (...args) => {
                const message = '‚ùå ERROR: ' + args.join(' ');
                appendOutput(message);
                originalConsoleError.apply(console, args);
            };
            
            console.warn = (...args) => {
                const message = '‚ö†Ô∏è WARNING: ' + args.join(' ');
                appendOutput(message);
                originalConsoleWarn.apply(console, args);
            };
        }
        
        function restoreConsole() {
            console.log = originalConsoleLog;
            console.error = originalConsoleError;
            console.warn = originalConsoleWarn;
        }
        
        function appendOutput(text) {
            output.textContent += text + '\n';
            if (autoScrollCheckbox.checked) {
                output.scrollTop = output.scrollHeight;
            }
        }
        
        function clearOutput() {
            output.textContent = 'üìå Output cleared. Ready for new test run.\n\n';
        }
        
        function setStatus(type, message) {
            status.className = `status ${type}`;
            statusText.textContent = message;
        }
        
        async function runAllTests() {
            setStatus('running', 'Running all tests...');
            clearOutput();
            setupConsoleCapture();
            
            setVerbose(verboseCheckbox.checked);
            
            try {
                appendOutput('üöÄ Starting complete test suite...\n');
                const results = await runTests();
                
                if (results.failed === 0) {
                    setStatus('completed', `‚úÖ All tests passed! (${results.passed}/${results.total})`);
                } else {
                    setStatus('error', `‚ùå ${results.failed} test(s) failed (${results.passed}/${results.total} passed)`);
                }
                
            } catch (error) {
                appendOutput(`\n‚ùå Test execution failed: ${error.message}`);
                setStatus('error', 'Test execution failed');
            } finally {
                restoreConsole();
            }
        }
        
        async function runGameTests() {
            setStatus('running', 'Running game tests...');
            clearOutput();
            setupConsoleCapture();
            
            setVerbose(verboseCheckbox.checked);
            
            try {
                appendOutput('üéØ Running game-specific tests...\n');
                // This would require filtering tests by suite - simplified for now
                const results = await runTests();
                setStatus('completed', 'Game tests completed');
            } catch (error) {
                appendOutput(`\n‚ùå Game test execution failed: ${error.message}`);
                setStatus('error', 'Game tests failed');
            } finally {
                restoreConsole();
            }
        }
        
        async function runDataTests() {
            setStatus('running', 'Running data tests...');
            clearOutput();
            setupConsoleCapture();
            
            setVerbose(verboseCheckbox.checked);
            
            try {
                appendOutput('üìä Running data module tests...\n');
                // This would require filtering tests by suite - simplified for now
                const results = await runTests();
                setStatus('completed', 'Data tests completed');
            } catch (error) {
                appendOutput(`\n‚ùå Data test execution failed: ${error.message}`);
                setStatus('error', 'Data tests failed');
            } finally {
                restoreConsole();
            }
        }
        
        async function runUITests() {
            setStatus('running', 'Running UI module tests...');
            clearOutput();
            setupConsoleCapture();
            
            setVerbose(verboseCheckbox.checked);
            
            try {
                appendOutput('üé® Running UI module tests...\n');
                
                // Run MonsterUI specific tests
                if (typeof runTests === 'function') {
                    const results = await runTests();
                }
                
                setStatus('completed', 'UI tests completed');
            } catch (error) {
                appendOutput(`\n‚ùå UI test execution failed: ${error.message}`);
                setStatus('error', 'UI tests failed');
            } finally {
                restoreConsole();
            }
        }
        
        async function validateUIRefactoring() {
            setStatus('running', 'Validating UI refactoring...');
            clearOutput();
            setupConsoleCapture();
            
            try {
                appendOutput('üîç Starting UI refactoring validation...\n');
                
                if (typeof UIRefactoringValidator !== 'undefined') {
                    const validator = new UIRefactoringValidator();
                    await validator.runValidation();
                    appendOutput('\n‚úÖ UI refactoring validation completed');
                } else {
                    appendOutput('\n‚ö†Ô∏è UIRefactoringValidator not available');
                }
                
                setStatus('completed', 'UI validation completed');
            } catch (error) {
                appendOutput(`\n‚ùå UI validation failed: ${error.message}`);
                setStatus('error', 'UI validation failed');
            } finally {
                restoreConsole();
            }
        }
        
        // Event listeners
        document.getElementById('run-all-tests').addEventListener('click', runAllTests);
        document.getElementById('run-game-tests').addEventListener('click', runGameTests);
        document.getElementById('run-data-tests').addEventListener('click', runDataTests);
        document.getElementById('run-ui-tests').addEventListener('click', runUITests);
        document.getElementById('validate-ui-refactoring').addEventListener('click', validateUIRefactoring);
        document.getElementById('clear-output').addEventListener('click', clearOutput);
        
        // Initialize
        setTimeout(() => {
            appendOutput('‚úÖ Test environment initialized');
            appendOutput(`‚úÖ Modules loaded: CharacterData=${typeof CharacterData !== 'undefined'}, MonsterData=${typeof MonsterData !== 'undefined'}, AreaData=${typeof AreaData !== 'undefined'}, StoryData=${typeof StoryData !== 'undefined'}`);
            appendOutput(`‚úÖ Game engine: SawyersRPG=${typeof SawyersRPG !== 'undefined'}`);
            appendOutput('\nüìã Ready to run tests! Click a button above to start.\n');
        }, 100);
    </script>
</body>
</html>